# å‘é‡æ•°æ®åº“ä½¿ç”¨åˆ†æ

**ç›¸å…³æ–‡æ¡£**ï¼š
- [é¡¹ç›®æ€»è§ˆ](PROJECT_OVERVIEW.md) - äº†è§£å‘é‡æ•°æ®åº“åœ¨æ•´ä½“æ¶æ„ä¸­çš„ä½ç½®
- [RAG é…ç½®](RAG_SETUP.md) - é…ç½® RAG æ¨¡å¼å’Œ Embedding
- [å¼€å‘æ—¥å¿—](DEVELOPMENT.md) - äº†è§£å‘é‡æ•°æ®åº“çš„æŠ€æœ¯å†³ç­–è¿‡ç¨‹

## å½“å‰æ–¹æ¡ˆï¼šSQLite + JavaScript è®¡ç®—

### å®ç°æ–¹å¼

ç³»ç»Ÿä½¿ç”¨ SQLite å­˜å‚¨å‘é‡ï¼Œé€šè¿‡ JavaScript è¿›è¡Œç›¸ä¼¼åº¦è®¡ç®—ï¼š

```javascript
// å­˜å‚¨æ–¹å¼
embedding TEXT  // JSON å­—ç¬¦ä¸²å­˜å‚¨ 1024 ç»´å‘é‡

// ç›¸ä¼¼åº¦è®¡ç®—
cosineSimilarity(vec1, vec2) {
  // JavaScript å¾ªç¯è®¡ç®—ä½™å¼¦ç›¸ä¼¼åº¦
  // æ—¶é—´å¤æ‚åº¦: O(n)ï¼Œn = å‘é‡ç»´åº¦
}

// å‘é‡æœç´¢
async vectorSearch(query, topK) {
  // 1. ç”ŸæˆæŸ¥è¯¢å‘é‡
  const queryVector = await this.embeddingService.getEmbedding(query);

  // 2. è·å–æ‰€æœ‰å‘é‡
  const allChunks = await this.getAllChunks();

  // 3. é€ä¸€è®¡ç®—ç›¸ä¼¼åº¦
  const scoredChunks = allChunks.map(chunk => {
    const similarity = this.cosineSimilarity(queryVector, chunk.embedding);
    return { ...chunk, score: similarity };
  });

  // 4. æ’åºå¹¶è¿”å› topK
  return scoredChunks.sort((a, b) => b.score - a.score).slice(0, topK);
}
```

### æ•°æ®é‡è¯„ä¼°

#### æµ‹è¯•ç¯å¢ƒ
- æ–‡æ¡£æ•°é‡: ~10 ä¸ª
- æ€»çŸ¥è¯†å—: ~500 ä¸ª
- æ¯ä¸ªå‘é‡: 1024 ç»´ float32 â‰ˆ 4KB
- æ€»å­˜å‚¨: ~2MB

#### å°å‹ç”Ÿäº§ç¯å¢ƒ
- æ–‡æ¡£æ•°é‡: 100-500 ä¸ª
- æ€»çŸ¥è¯†å—: 5,000-25,000 ä¸ª
- æ€»å­˜å‚¨: 20-100MB

#### ä¸­å‹ç”Ÿäº§ç¯å¢ƒ
- æ–‡æ¡£æ•°é‡: 1,000-10,000 ä¸ª
- æ€»çŸ¥è¯†å—: 50,000-500,000 ä¸ª
- æ€»å­˜å‚¨: 200MB-2GB

---

## SQLite æ–¹æ¡ˆåˆ†æ

### âœ… ä¼˜ç‚¹

1. **ç®€å•æ˜“ç”¨**
   - æ— éœ€é¢å¤–æœåŠ¡
   - é›¶é…ç½®æˆæœ¬
   - å•æ–‡ä»¶å­˜å‚¨

2. **å¼€å‘å‹å¥½**
   - è°ƒè¯•æ–¹ä¾¿
   - æ˜“äºå¤‡ä»½
   - è¿ç§»ç®€å•

3. **èµ„æºå ç”¨ä½**
   - å†…å­˜å ç”¨å°
   - CPU å¼€é”€å¯æ§
   - ç£ç›˜ I/O å°‘

4. **æˆæœ¬ä¸ºé›¶**
   - å®Œå…¨å…è´¹
   - æ— äº‘æœåŠ¡è´¹ç”¨
   - æ— éœ€ API key

### âŒ ç¼ºç‚¹

1. **æ€§èƒ½ç“¶é¢ˆ**
   - å…¨è¡¨æ‰«æ: O(n)ï¼Œn = çŸ¥è¯†å—æ•°é‡
   - çº¿æ€§æœç´¢: æ¯ä¸ªå‘é‡éƒ½è¦è®¡ç®—
   - å“åº”æ—¶é—´: éšæ•°æ®é‡å¢é•¿

2. **å†…å­˜æ¶ˆè€—**
   - æ‰€æœ‰å‘é‡åŠ è½½åˆ°å†…å­˜
   - å¤§æ•°æ®é›†ä¼šå ç”¨å¤§é‡ RAM

3. **æ— ç´¢å¼•ä¼˜åŒ–**
   - æ— å‘é‡ç´¢å¼•
   - æ— æ³•åˆ©ç”¨æ•°æ®åº“ä¼˜åŒ–

### æ€§èƒ½æµ‹è¯•é¢„ä¼°

| çŸ¥è¯†å—æ•°é‡ | æŸ¥è¯¢æ—¶é—´ | å†…å­˜å ç”¨ | é€‚ç”¨åœºæ™¯ |
|----------|---------|---------|----------|
| 1,000 | < 50ms | ~4MB | âœ… å®Œå…¨å¤Ÿç”¨ |
| 10,000 | 200-500ms | ~40MB | âš ï¸ å¯æ¥å— |
| 50,000 | 1-2s | ~200MB | âŒ åæ…¢ |
| 100,000 | 2-5s | ~400MB | âŒ ä¸å¯æ¥å— |
| 1,000,000 | 20-50s | ~4GB | âŒ å®Œå…¨ä¸å¯ç”¨ |

---

## SQLite æ˜¯å¦è¶³å¤Ÿï¼Ÿ

### âœ… è¶³å¤Ÿçš„åœºæ™¯

| åœºæ™¯ | æ•°æ®è§„æ¨¡ | å“åº”è¦æ±‚ | SQLite è¯„ä»· |
|------|---------|---------|------------|
| ä¸ªäººé¡¹ç›® | < 1,000 | < 1s | âœ… å®Œç¾ |
| å°å‹ç”µå•† | < 5,000 | < 1s | âœ… å®Œç¾ |
| ä¸­å°å‹å›¢é˜Ÿ | < 10,000 | < 2s | âœ… å¯æ¥å— |
| æµ‹è¯•/POC | < 10,000 | æ— è¦æ±‚ | âœ… å®Œç¾ |
| å†…éƒ¨çŸ¥è¯†åº“ | < 20,000 | < 3s | âš ï¸ å¯ç”¨ |

### âŒ ä¸å¤Ÿçš„åœºæ™¯

| åœºæ™¯ | æ•°æ®è§„æ¨¡ | å“åº”è¦æ±‚ | SQLite é—®é¢˜ |
|------|---------|---------|------------|
| å¤§å‹ç”µå•† | > 50,000 | < 500ms | å“åº”å¤ªæ…¢ |
| SaaS äº§å“ | > 100,000 | < 1s | å†…å­˜å’Œæ€§èƒ½éƒ½ä¸å¤Ÿ |
| å¤šç§Ÿæˆ·ç³»ç»Ÿ | > 500,000 | < 1s | å®Œå…¨ä¸å¯ç”¨ |
| å®æ—¶æ£€ç´¢ | ä»»æ„ | < 100ms | æ— æ³•æ»¡è¶³ |

---

## æ”¹è¿›æ–¹æ¡ˆå¯¹æ¯”

### æ–¹æ¡ˆ1: å½“å‰æ–¹æ¡ˆï¼ˆSQLite + JSï¼‰
```
ä¼˜ç‚¹: é›¶æˆæœ¬ã€é›¶é…ç½®ã€ç®€å•
ç¼ºç‚¹: æ€§èƒ½çº¿æ€§ä¸‹é™
é€‚ç”¨: < 20,000 çŸ¥è¯†å—
```

### æ–¹æ¡ˆ2: SQLite + sqlite-vec æ‰©å±•
```
ä¼˜ç‚¹: å‘é‡ç´¢å¼•ã€é«˜æ€§èƒ½ã€é›¶æˆæœ¬
ç¼ºç‚¹: éœ€è¦ç¼–è¯‘æ‰©å±•
é€‚ç”¨: < 100,000 çŸ¥è¯†å—
æ€§èƒ½: æ¯”æ–¹æ¡ˆ1 å¿« 10-50 å€
```

**å®ç°ç¤ºä¾‹**:
```javascript
const sqlite3 = require('sqlite3');
const { load } = require('sqlite-vec');

// åŠ è½½æ‰©å±•
load();

// åˆ›å»ºå‘é‡ç´¢å¼•
db.run(`
  CREATE VIRTUAL TABLE vec_chunks USING vec0(
    embedding float[1024],
    content text
  )
`);

// å‘é‡æœç´¢ï¼ˆä½¿ç”¨ç´¢å¼•ï¼‰
db.all(`
  SELECT content, distance
  FROM vec_chunks
  WHERE embedding MATCH ?1
  ORDER BY distance
  LIMIT 5
`, [queryVector]);
```

### æ–¹æ¡ˆ3: Pineconeï¼ˆäº‘å‘é‡æ•°æ®åº“ï¼‰
```
ä¼˜ç‚¹: é«˜æ€§èƒ½ã€å¯æ‰©å±•ã€æ‰˜ç®¡æœåŠ¡
ç¼ºç‚¹: ä»˜è´¹ã€éœ€è¦ API key
é€‚ç”¨: ä»»æ„è§„æ¨¡
æ€§èƒ½: æ¯«ç§’çº§å“åº”
æˆæœ¬:
  - Starter: $70/æœˆ (100 ä¸‡å‘é‡)
  - Standard: $70/æœˆèµ·
```

### æ–¹æ¡ˆ4: Milvusï¼ˆå¼€æºå‘é‡æ•°æ®åº“ï¼‰
```
ä¼˜ç‚¹: é«˜æ€§èƒ½ã€å®Œå…¨å¼€æºã€æ”¯æŒåˆ†å¸ƒå¼
ç¼ºç‚¹: éœ€è¦éƒ¨ç½²ã€è¿ç»´æˆæœ¬
é€‚ç”¨: > 100,000 çŸ¥è¯†å—
æ€§èƒ½: æ¯«ç§’çº§å“åº”
éƒ¨ç½²: Docker/Kubernetes
```

### æ–¹æ¡ˆ5: Qdrantï¼ˆè½»é‡çº§å‘é‡æ•°æ®åº“ï¼‰
```
ä¼˜ç‚¹: è½»é‡çº§ã€æ˜“éƒ¨ç½²ã€é«˜æ€§èƒ½
ç¼ºç‚¹: éœ€è¦é¢å¤–æœåŠ¡
é€‚ç”¨: 10,000-1,000,000 çŸ¥è¯†å—
æ€§èƒ½: æ¯«ç§’çº§å“åº”
éƒ¨ç½²: Dockerï¼Œå ç”¨å†…å­˜ ~100MB
```

---

## æ¨èæ–¹æ¡ˆ

### å½“å‰é˜¶æ®µï¼ˆ< 10,000 çŸ¥è¯†å—ï¼‰

**æ¨è: ç»§ç»­ä½¿ç”¨ SQLite**

**ç†ç”±**:
- âœ… å½“å‰æ•°æ®è§„æ¨¡å®Œå…¨å¤Ÿç”¨
- âœ… é›¶æˆæœ¬ã€é›¶é…ç½®
- âœ… å¼€å‘å’Œæµ‹è¯•æ•ˆç‡é«˜
- âœ… è¿ç§»é£é™©ä½

**ä¼˜åŒ–å»ºè®®**:
1. æ·»åŠ ç¼“å­˜æœºåˆ¶ï¼ˆRedis ç¼“å­˜æŸ¥è¯¢ç»“æœï¼‰
2. å®ç°åˆ†é¡µåŠ è½½
3. å¢åŠ çŸ¥è¯†å—è¿‡æ»¤ï¼ˆæŒ‰æ—¶é—´ã€ç±»åˆ«ç­‰ï¼‰
4. ä½¿ç”¨ Worker çº¿ç¨‹è®¡ç®—ç›¸ä¼¼åº¦

### æˆé•¿é˜¶æ®µï¼ˆ10,000 - 50,000 çŸ¥è¯†å—ï¼‰

**æ¨è: è¿ç§»åˆ° Qdrant**

**ç†ç”±**:
- âœ… è½»é‡çº§ï¼Œéƒ¨ç½²ç®€å•
- âœ… æ€§èƒ½æå‡ 100-1000 å€
- âœ… å¼€æºå…è´¹
- âœ… Rust å®ç°ï¼Œæ€§èƒ½ä¼˜ç§€

**éƒ¨ç½²æ­¥éª¤**:
```bash
# 1. å¯åŠ¨ Qdrant
docker run -p 6333:6333 qdrant/qdrant

# 2. å®‰è£…å®¢æˆ·ç«¯
npm install @qdrant/js-client-rest

# 3. ä¿®æ”¹ä»£ç ä½¿ç”¨ Qdrant
```

### è§„æ¨¡é˜¶æ®µï¼ˆ> 50,000 çŸ¥è¯†å—ï¼‰

**æ¨è: Pinecone æˆ– Milvus**

**ç†ç”±**:
- âœ… ä¼ä¸šçº§æ€§èƒ½
- âœ… å®Œå–„çš„ç›‘æ§å’Œç®¡ç†
- âœ… æ”¯æŒåˆ†å¸ƒå¼
- âœ… æŒç»­ä¼˜åŒ–

---

## è¿ç§»ç­–ç•¥

### é˜¶æ®µ1: ä¿æŒç°çŠ¶ï¼ˆ0-6 ä¸ªæœˆï¼‰

**ç›®æ ‡**:
- éªŒè¯äº§å“ä»·å€¼
- ç§¯ç´¯ç”¨æˆ·åé¦ˆ
- äº†è§£å®é™…æ•°æ®è§„æ¨¡

**ç›‘æ§æŒ‡æ ‡**:
- çŸ¥è¯†å—æ€»æ•°
- å¹³å‡æŸ¥è¯¢æ—¶é—´
- ç”¨æˆ·æ»¡æ„åº¦

### é˜¶æ®µ2: ä¼˜åŒ– SQLiteï¼ˆ6-12 ä¸ªæœˆï¼‰

**ç›®æ ‡**:
- å»¶ç¼“è¿ç§»
- æå‡æ€§èƒ½
- ä¿æŒä½æˆæœ¬

**æªæ–½**:
- æ·»åŠ  Redis ç¼“å­˜
- å®ç°é¢„åŠ è½½
- ä¼˜åŒ–ç›¸ä¼¼åº¦è®¡ç®—

### é˜¶æ®µ3: è¯„ä¼°è¿ç§»ï¼ˆ12-18 ä¸ªæœˆï¼‰

**ç›®æ ‡**:
- è¯„ä¼°è¿ç§»å¿…è¦æ€§
- é€‰æ‹©åˆé€‚æ–¹æ¡ˆ
- è§„åˆ’è¿ç§»è·¯å¾„

**å†³ç­–ä¾æ®**:
- çŸ¥è¯†å—æ•°é‡ > 50,000
- å¹³å‡æŸ¥è¯¢æ—¶é—´ > 1s
- ç”¨æˆ·æŠ•è¯‰å¢åŠ 

### é˜¶æ®µ4: æ‰§è¡Œè¿ç§»ï¼ˆ18+ ä¸ªæœˆï¼‰

**ç›®æ ‡**:
- å¹³æ»‘è¿ç§»
- é›¶åœæœº
- ä¿æŒæœåŠ¡

**æ–¹æ¡ˆ**:
- åŒå†™ç­–ç•¥ï¼ˆSQLite + æ–°åº“ï¼‰
- ç°åº¦åˆ‡æ¢
- å›æ»šé¢„æ¡ˆ

---

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

### çŸ­æœŸä¼˜åŒ–ï¼ˆå½“å‰æ¶æ„ï¼‰

```javascript
// 1. æ·»åŠ æŸ¥è¯¢ç¼“å­˜
class VectorKnowledgeBase {
  constructor() {
    this.cache = new Map(); // æˆ–ä½¿ç”¨ Redis
  }

  async vectorSearch(query, topK) {
    const cacheKey = `${query}-${topK}`;
    if (this.cache.has(cacheKey)) {
      return this.cache.get(cacheKey);
    }

    const results = await this.search(query, topK);
    this.cache.set(cacheKey, results, 3600); // ç¼“å­˜1å°æ—¶
    return results;
  }
}

// 2. ä½¿ç”¨ Worker çº¿ç¨‹
const { Worker } = require('worker_threads');

async parallelSimilarity(queryVector, chunks) {
  const workers = [];
  const chunkSize = Math.ceil(chunks.length / 4); // 4ä¸ªWorker

  for (let i = 0; i < 4; i++) {
    const worker = new Worker('./similarity-worker.js', {
      workerData: chunks.slice(i * chunkSize, (i + 1) * chunkSize)
    });
    workers.push(worker);
  }

  const results = await Promise.all(workers.map(w => w));
  return results.flat();
}

// 3. é¢„åŠ è½½å‘é‡
class VectorKnowledgeBase {
  async initialize() {
    this.allChunks = await this.getAllChunks();
    // å‘é‡å·²åœ¨å†…å­˜ä¸­
  }

  async vectorSearch(query) {
    const queryVector = await this.embeddingService.getEmbedding(query);

    // ç›´æ¥ä½¿ç”¨å†…å­˜ä¸­çš„å‘é‡
    return this.allChunks
      .map(chunk => ({
        ...chunk,
        score: this.cosineSimilarity(queryVector, chunk.embedding)
      }))
      .sort((a, b) => b.score - a.score)
      .slice(0, 5);
  }
}
```

### ä¸­æœŸä¼˜åŒ–ï¼ˆè¿ç§»å‡†å¤‡ï¼‰

```javascript
// 1. æŠ½è±¡å‘é‡å­˜å‚¨æ¥å£
interface IVectorStore {
  insert(vector, metadata);
  search(queryVector, topK);
  delete(id);
}

// 2. å®ç°å¤šç§å­˜å‚¨
class SQLiteVectorStore implements IVectorStore { ... }
class QdrantVectorStore implements IVectorStore { ... }
class PineconeVectorStore implements IVectorStore { ... }

// 3. é€šè¿‡é…ç½®åˆ‡æ¢
const vectorStore = process.env.VECTOR_STORE === 'qdrant'
  ? new QdrantVectorStore()
  : new SQLiteVectorStore();
```

---

## ç»“è®º

### å¯¹äºå½“å‰é¡¹ç›®

**SQLite å®Œå…¨è¶³å¤Ÿï¼**

**ç†ç”±**:
1. å½“å‰æ•°æ®è§„æ¨¡ï¼ˆ< 1,000 çŸ¥è¯†å—ï¼‰è¿œæœªè¾¾åˆ°ç“¶é¢ˆ
2. æŸ¥è¯¢å“åº”æ—¶é—´ < 100msï¼Œç”¨æˆ·ä½“éªŒè‰¯å¥½
3. é›¶æˆæœ¬ã€é›¶é…ç½®ï¼Œå¼€å‘æ•ˆç‡é«˜
4. è¿ç§»æˆæœ¬è¿œå¤§äºæ”¶ç›Š

### ä½•æ—¶éœ€è¦è¿ç§»

**è¿ç§»è§¦å‘æ¡ä»¶**ï¼ˆæ»¡è¶³ä»»ä¸€å³è€ƒè™‘ï¼‰:
- âœ… çŸ¥è¯†å—æ•°é‡ > 50,000
- âœ… å¹³å‡æŸ¥è¯¢æ—¶é—´ > 1s
- âœ… å†…å­˜å ç”¨ > 2GB
- âœ… ç”¨æˆ·æŠ•è¯‰æ€§èƒ½é—®é¢˜

**æ¨èè¿ç§»æ—¶æœº**:
- çŸ¥è¯†å—æ•°é‡è¾¾åˆ° 20,000 æ—¶å¼€å§‹è¯„ä¼°
- è¾¾åˆ° 50,000 æ—¶æ‰§è¡Œè¿ç§»

### æœ€ç»ˆå»ºè®®

```
ç°åœ¨ â†’ ç»§ç»­ä½¿ç”¨ SQLite âœ…
      æ·»åŠ ç¼“å­˜ã€é¢„åŠ è½½ä¼˜åŒ– âš¡
      ç›‘æ§æ€§èƒ½æŒ‡æ ‡ ğŸ“Š

6ä¸ªæœˆå â†’ æ ¹æ®æ•°æ®è§„æ¨¡å†³å®š ğŸ¤”

å¦‚éœ€è¿ç§» â†’ ä¼˜å…ˆé€‰æ‹© Qdrant ğŸ¯
         æ€§ä»·æ¯”æœ€é«˜ã€éƒ¨ç½²ç®€å•
```

---

## å‚è€ƒèµ„æ–™

### SQLite å‘é‡æ‰©å±•
- [sqlite-vec](https://github.com/asg017/sqlite-vec) - SQLite å‘é‡æœç´¢æ‰©å±•
- [sqlite-vec-go](https://github.com/asg017/sqlite-vec-go) - Go ç‰ˆæœ¬

### å¼€æºå‘é‡æ•°æ®åº“
- [Qdrant](https://qdrant.tech/) - è½»é‡çº§å‘é‡æ•°æ®åº“
- [Milvus](https://milvus.io/) - åˆ†å¸ƒå¼å‘é‡æ•°æ®åº“
- [Weaviate](https://weaviate.io/) - AI åŸç”Ÿå‘é‡æ•°æ®åº“

### äº‘å‘é‡æ•°æ®åº“
- [Pinecone](https://www.pinecone.io/) - æ‰˜ç®¡å‘é‡æ•°æ®åº“
- [Zilliz](https://zilliz.com/) - Milvus äº‘æœåŠ¡
- [Weaviate Cloud](https://weaviate.io/cloud) - Weaviate äº‘æœåŠ¡

### æ€§èƒ½å¯¹æ¯”
- [ANN-Benchmarks](https://github.com/erikbern/ann-benchmarks) - å‘é‡æœç´¢æ€§èƒ½åŸºå‡†æµ‹è¯•
- [Vector Database Comparison](https://www.pinecone.io/learn/vector-database-comparison) - å‘é‡æ•°æ®åº“å¯¹æ¯”
